<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quizzone | Progress Analytics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    background:#eef3ff;
    font-family:"Segoe UI",Arial;
}

/* BOX */
.progress-container{
    width:90%;
    max-width:1100px;
    margin:70px auto;
    background:white;
    padding:25px;
    border-radius:14px;
    box-shadow:0 4px 20px rgba(0,0,0,0.2);
}

/* CHART BLOCK */
.chart-block{
    margin:30px 0;
    padding:20px;
    background:#f4f8ff;
    border-radius:14px;
}

h2{ color:#007bff; }
h3{ color:#005fcc; }
canvas { width:100% !important; max-height:350px; }
</style>
</head>
<body>

<!-- GLOBAL NAVBAR + FOOTER -->
<script src="/Quizzone/Global/loader.js"></script>

<div class="progress-container">
    <h2>Your Progress Insights</h2>

    <div class="chart-block">
        <h3>Blogs Completed</h3>
        <canvas id="blogChart"></canvas>
    </div>

    <div class="chart-block">
        <h3>Competency Tests Status</h3>
        <canvas id="compChart"></canvas>
    </div>

    <div class="chart-block">
        <h3>Quiz Score Timeline</h3>
        <canvas id="scoreChart"></canvas>
    </div>
</div>

<script>
// LOAD USER
let user = JSON.parse(localStorage.getItem("ActiveQuizzoneUser"));
if(!user){ alert("Please login first."); window.location.href="/Quizzone/Home/SignIn.htm"; }

// FALLBACKS
let blogs = user.progress.blogs || 0;
let comp = user.progress.compTests || 0;
let scores = user.scores || {};
let quizLabels = Object.keys(scores);
let quizValues = Object.values(scores);

// ------------------------- BLOG CHART -------------------------
new Chart(document.getElementById("blogChart"), {
    type: "bar",
    data: {
        labels: ["Blogs Read"],
        datasets: [{
            label: "Completed",
            data: [blogs],
            backgroundColor: "#007bff"
        }]
    },
    options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
    }
});

// ------------------------- COMPETENCY PIE CHART -------------------------
new Chart(document.getElementById("compChart"), {
    type: "pie",
    data: {
        labels: ["Completed", "Remaining"],
        datasets: [{
            data: [comp, Math.max(10 - comp, 0)], 
            backgroundColor: ["#28a745", "#ffc107"]
        }]
    }
});

// ------------------------- QUIZ SCORE LINE CHART -------------------------
new Chart(document.getElementById("scoreChart"), {
    type: "line",
    data: {
        labels: quizLabels.length ? quizLabels : ["No Quizzes Yet"],
        datasets: [{
            label: "Quiz Scores",
            data: quizValues.length ? quizValues : [0],
            borderColor: "#ff5733",
            fill: false,
            tension: 0.3
        }]
    }
});
</script>

</body>
</html>
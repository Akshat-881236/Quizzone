<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QuizzoneAI Workspace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
/* ================= THEME ================= */
:root{
  --bg:#f4f7fb;
  --panel:#ffffff;
  --panel-soft:#f1f5ff;
  --accent:#2563eb;
  --accent-soft:#dbeafe;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e5e7eb;
}
[data-theme="dark"]{
  --bg:#020617;
  --panel:#0f172a;
  --panel-soft:#020617;
  --accent:#38bdf8;
  --accent-soft:#0c4a6e;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --border:#1e293b;
}

*{box-sizing:border-box;font-family:"Segoe UI",Arial}
body{
  margin:0;
  height:100vh;
  background:var(--bg);
  color:var(--text);
}

/* ================= APP LAYOUT ================= */
.app{
  display:grid;
  grid-template-columns:300px 1fr;
  height:100%;
}

/* ================= SIDEBAR ================= */
aside.sidebar{
  display:flex;
  flex-direction:column;
  background:var(--panel);
  border-right:1px solid var(--border);
}

.sidebar header{
  padding:18px;
  display:flex;
  gap:12px;
  align-items:center;
  border-bottom:1px solid var(--border);
}

.sidebar header img{
  width:48px;height:48px;border-radius:14px;
}
.sidebar header div{
  display:flex;
  flex-direction:column;
}
.sidebar header span{
  font-size:12px;color:var(--muted);
}

.sidebar nav{
  padding:14px;
  flex:1;
  overflow:auto;
}

.sidebar section{
  margin-bottom:20px;
}
.sidebar section h4{
  font-size:12px;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:8px;
}

.chat-list{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.chat-item{
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.chat-item span{
  font-size:13px;
}
.chat-item.active,
.chat-item:hover{
  background:var(--accent-soft);
  color:var(--accent);
}

.sidebar footer{
  padding:14px;
  border-top:1px solid var(--border);
}
.sidebar footer button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  background:var(--accent);
  color:white;
}

/* ================= MAIN ================= */
main.main{
  display:flex;
  flex-direction:column;
}

/* ================= TOP BAR ================= */
header.topbar{
  height:58px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 18px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}

.topbar .left,
.topbar .right{
  display:flex;
  align-items:center;
  gap:12px;
}
.topbar input{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid var(--border);
}

/* ================= CHAT AREA ================= */
section.chat-wrapper{
  flex:1;
  display:flex;
  flex-direction:column;
}

.cloud{
  padding:8px 20px;
  font-size:12px;
  color:var(--muted);
  display:none;
}

.chat-area{
  flex:1;
  padding:22px;
  overflow-y:auto;
}

article.message{
  max-width:75%;
  margin-bottom:18px;
  display:flex;
  flex-direction:column;
}
article.message.user{margin-left:auto;align-items:flex-end}

.message .meta{
  font-size:11px;
  color:var(--muted);
  margin-bottom:4px;
}

.message .bubble{
  background:var(--panel);
  padding:14px;
  border-radius:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}
.user .bubble{
  background:var(--accent);
  color:white;
}

.message .tools{
  margin-top:6px;
}
.message .tools i{
  font-size:13px;
  margin-right:8px;
  cursor:pointer;
  opacity:.6;
}
.message .tools i:hover{opacity:1}

/* ================= CODE CONTAINER ================= */
.code-container{
  margin-top:10px;
  background:#020617;
  color:#e5e7eb;
  border-radius:12px;
  padding:10px;
  font-family:monospace;
  font-size:13px;
}
.code-header{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:#94a3b8;
}
.code-actions i{
  margin-left:10px;
  cursor:pointer;
}
.code-body{
  white-space:pre;
  overflow-x:auto;
  outline:none;
}

/* ================= INPUT ================= */
footer.input-box{
  padding:14px;
  border-top:1px solid var(--border);
  display:flex;
  gap:12px;
  background:var(--panel);
}
footer.input-box input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
}
footer.input-box button{
  padding:12px 18px;
  border:none;
  border-radius:12px;
  background:var(--accent);
  color:white;
}

/* ================= PREVIEW ================= */
.preview-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:flex;align-items:center;justify-content:center;
}
.preview-box{
  width:80%;height:80%;
  background:white;border-radius:14px;
}
.preview-box iframe{width:100%;height:100%;border:none}
</style>
</head>

<body data-theme="light">

<div class="app">

<!-- ================= SIDEBAR ================= -->
<aside class="sidebar">

<header>
  <img src="/Quizzone/icons/icon-192.png">
  <div>
    <strong id="uname"></strong>
    <span>Active User</span>
  </div>
</header>

<nav>
  <section>
    <h4>Chats</h4>
    <div class="chat-list" id="chatList"></div>
  </section>

  <section>
    <h4>Actions</h4>
    <div class="chat-item" onclick="newChat()">
      <span>New Chat</span>
      <i class="bi bi-plus-circle"></i>
    </div>
  </section>
</nav>

<footer>
  <button onclick="toggleTheme()">
    <i class="bi bi-moon"></i> Toggle Theme
  </button>
</footer>

</aside>

<!-- ================= MAIN ================= -->
<main class="main">

<header class="topbar">
  <div class="left">
    <strong>QuizzoneAI</strong>
    <span class="badge">Workspace</span>
  </div>
  <div class="right">
    <input placeholder="Search‚Ä¶" />
    <i class="bi bi-trash" onclick="clearChat()"></i>
  </div>
</header>

<section class="chat-wrapper">

<div class="cloud" id="cloud">
  <i class="bi bi-cloud"></i> QuizzoneAI is thinking‚Ä¶
</div>

<div class="chat-area" id="chatArea"></div>

</section>

<footer class="input-box">
  <input id="input" placeholder="Ask QuizzoneAI‚Ä¶" />
  <button onclick="send()"><i class="bi bi-send"></i></button>
</footer>

</main>
</div>
<script>
/* =====================================================
   USER
===================================================== */
const user = JSON.parse(localStorage.getItem("ActiveQuizzoneUser")) || {
  username: "Guest"
};
document.getElementById("uname").innerText = user.username;

/* =====================================================
   STORAGE KEYS
===================================================== */
const STORAGE_KEY = "QUIZZONE_AI_STATE";

/* =====================================================
   STATE
===================================================== */
let state = loadState();
let activeChatId = state.activeChatId;
let chats = state.chats;

/* =====================================================
   UTILITIES
===================================================== */
function genId(len){
  return Array.from({length:len},()=>Math.floor(Math.random()*10)).join("");
}
function now(){
  return new Date().toISOString();
}

/* =====================================================
   LOAD / SAVE
===================================================== */
function loadState(){
  let s = JSON.parse(localStorage.getItem(STORAGE_KEY));
  if(!s){
    const id = genId(10);
    s = {
      activeChatId: id,
      chats: {
        [id]: createChat(id, true)
      }
    };
    saveState(s);
  }
  return s;
}

function saveState(customState){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(customState || state));
}

/* =====================================================
   CHAT FACTORY
===================================================== */
function createChat(id, withWelcome=false){
  const chat = {
    id,
    title: "New Chat",
    created: now(),
    messages:[]
  };
  if(withWelcome){
    chat.messages.push({
      id: genId(24),
      role: "ai",
      content: welcomeMessage(),
      time: now()
    });
  }
  return chat;
}

/* =====================================================
   WELCOME MESSAGE (ONCE)
===================================================== */
function getGreeting(){
  const h=new Date().getHours();
  if(h<12) return "Good morning";
  if(h<17) return "Good afternoon";
  if(h<21) return "Good evening";
  return "Good night";
}

function welcomeMessage(){
  return `
<b>${getGreeting()}, ${user.username} üëã</b><br><br>
I am <b>QuizzoneAI</b>, your learning assistant.<br>
Ask me about concepts, quizzes, or code.
`;
}

/* =====================================================
   KNOWLEDGE BASE
===================================================== */
  const KB = [

/* ================= BASIC IDENTITY ================= */
{
  k:["what is quizzoneai","define quizzoneai","about quizzoneai"],
  type:"info",
  tags:["intro","platform"],
  v:`
  <b>QuizzoneAI</b> is an intelligent learning assistant designed for
  <b>students, developers, and self-learners</b>.<br><br>

  It helps you:
  <ul>
    <li>Understand concepts quickly</li>
    <li>Practice quizzes & tests</li>
    <li>Learn coding with examples</li>
    <li>Track learning progress</li>
  </ul>

  <span style="color:gray;font-size:12px">
    Module: AI Chat ‚Ä¢ Quiz ‚Ä¢ Code ‚Ä¢ Progress
  </span>
  `
},

/* ================= CODE DEMO ================= */
{
  k:["code","html code","example code","show code"],
  type:"code",
  tags:["html","demo"],
  v:`
  <pre>
Code:
&lt;h1&gt;Hello QuizzoneAI&lt;/h1&gt;

Output:
<h1>Hello QuizzoneAI</h1>
  </pre>
  `
},

/* ================= HTML EXPLANATION ================= */
{
  k:["what is html","define html","html meaning"],
  type:"tutorial",
  tags:["html","web"],
  v:`
  <b>HTML (HyperText Markup Language)</b> is the standard language used
  to create web pages.<br><br>

  <b>Example:</b>
  <pre>
&lt;p&gt;This is a paragraph&lt;/p&gt;
  </pre>

  <b>Output:</b>
  <p>This is a paragraph</p>
  `
},

/* ================= CSS DEMO ================= */
{
  k:["css example","what is css","css demo"],
  type:"code",
  tags:["css","style"],
  v:`
  <pre>
Code:
&lt;style&gt;
h1 { color: blue; }
&lt;/style&gt;

&lt;h1&gt;Styled Heading&lt;/h1&gt;

Output:
<h1 style="color:blue">Styled Heading</h1>
  </pre>
  `
},

/* ================= JAVASCRIPT DEMO ================= */
{
  k:["javascript example","js example","what is javascript"],
  type:"code",
  tags:["javascript","logic"],
  v:`
  <pre>
Code:
&lt;script&gt;
alert("Hello QuizzoneAI");
&lt;/script&gt;

Explanation:
This JavaScript code shows an alert popup.
  </pre>
  `
},

/* ================= PLATFORM FEATURES ================= */
{
  k:["features","what can you do","capabilities"],
  type:"info",
  tags:["features","ai"],
  v:`
  <b>QuizzoneAI Capabilities</b>
  <ul>
    <li>Smart AI Chat</li>
    <li>Quiz Generation</li>
    <li>Code Explanation & Preview</li>
    <li>Learning Progress Tracking</li>
    <li>Offline-first Architecture</li>
  </ul>
  `
},

/* ================= COMMAND GUIDE ================= */
{
  k:["commands","how to delete","chat commands"],
  type:"info",
  tags:["commands","control"],
  v:`
  <b>Supported Commands</b><br><br>

  <code>delete message id = 123...</code><br>
  <code>clear chat</code><br>
  <code>new chat</code><br><br>

  Commands are parsed before AI response.
  `
},

/* ================= PYTHON INTRO ================= */
{
  k:["what is python","define python","python language"],
  type:"tutorial",
  tags:["python","programming"],
  v:`
  <b>Python</b> is a high-level, interpreted programming language known for
  its simplicity and readability.<br><br>

  <b>Example:</b>
  <pre>
print("Hello QuizzoneAI")
  </pre>

  <b>Output:</b><br>
  Hello QuizzoneAI
  `
},

/* ================= C++ INTRO ================= */
{
  k:["what is c++","define c++","c++ language"],
  type:"tutorial",
  tags:["cpp","programming"],
  v:`
  <b>C++</b> is a powerful programming language used for system software,
  games, and performance-critical applications.<br><br>

  <b>Example:</b>
  <pre>
#include &lt;iostream&gt;
using namespace std;

int main(){
  cout &lt;&lt; "Hello QuizzoneAI";
}
  </pre>
  `
},

/* ================= JAVA INTRO ================= */
{
  k:["what is java","define java","java language"],
  type:"tutorial",
  tags:["java","programming"],
  v:`
  <b>Java</b> is an object-oriented, platform-independent programming language.<br><br>

  <b>Example:</b>
  <pre>
class Hello {
  public static void main(String[] args){
    System.out.println("Hello QuizzoneAI");
  }
}
  </pre>
  `
},

/* ================= SQL INTRO ================= */
{
  k:["what is sql","define sql","sql meaning"],
  type:"tutorial",
  tags:["sql","database"],
  v:`
  <b>SQL (Structured Query Language)</b> is used to manage and query databases.<br><br>

  <b>Example:</b>
  <pre>
SELECT * FROM students;
  </pre>
  `
},

/* ================= OPERATING SYSTEM ================= */
{
  k:["what is operating system","define os","os meaning"],
  type:"tutorial",
  tags:["os","computer"],
  v:`
  An <b>Operating System (OS)</b> is system software that manages hardware
  and software resources.<br><br>

  Examples:
  <ul>
    <li>Windows</li>
    <li>Linux</li>
    <li>macOS</li>
  </ul>
  `
},

/* ================= DBMS ================= */
{
  k:["what is dbms","define dbms","dbms meaning"],
  type:"tutorial",
  tags:["dbms","database"],
  v:`
  <b>DBMS (Database Management System)</b> is software used to store,
  retrieve, and manage data efficiently.<br><br>

  Examples:
  <ul>
    <li>MySQL</li>
    <li>PostgreSQL</li>
    <li>Oracle</li>
  </ul>
  `
},

/* ================= DATA STRUCTURES ================= */
{
  k:["what is data structure","define data structure"],
  type:"tutorial",
  tags:["ds","computer science"],
  v:`
  A <b>Data Structure</b> is a way of organizing data for efficient access
  and modification.<br><br>

  Examples:
  <ul>
    <li>Array</li>
    <li>Stack</li>
    <li>Queue</li>
    <li>Tree</li>
  </ul>
  `
},

/* ================= ALGORITHMS ================= */
{
  k:["what is algorithm","define algorithm"],
  type:"tutorial",
  tags:["algorithm","logic"],
  v:`
  An <b>Algorithm</b> is a step-by-step procedure to solve a problem.<br><br>

  Example:
  <ol>
    <li>Start</li>
    <li>Process data</li>
    <li>End</li>
  </ol>
  `
},

/* ================= AI INTRO ================= */
{
  k:["what is ai","define artificial intelligence"],
  type:"tutorial",
  tags:["ai","technology"],
  v:`
  <b>Artificial Intelligence (AI)</b> enables machines to simulate
  human intelligence such as learning and decision-making.
  `
},

/* ================= MACHINE LEARNING ================= */
{
  k:["what is machine learning","define ml"],
  type:"tutorial",
  tags:["ml","ai"],
  v:`
  <b>Machine Learning</b> is a subset of AI that allows systems to learn
  from data without explicit programming.
  `
},

/* ================= CLOUD COMPUTING ================= */
{
  k:["what is cloud computing","define cloud"],
  type:"tutorial",
  tags:["cloud","technology"],
  v:`
  <b>Cloud Computing</b> delivers computing services like storage and
  servers over the internet.<br><br>

  Examples:
  <ul>
    <li>AWS</li>
    <li>Azure</li>
    <li>Google Cloud</li>
  </ul>
  `
},

/* ================= QUIZZONE USAGE ================= */
{
  k:["how to use quizzoneai","use quizzoneai","getting started"],
  type:"info",
  tags:["guide","usage"],
  v:`
  <b>Getting Started with QuizzoneAI</b><br><br>

  1. Ask a question<br>
  2. Explore concepts & code<br>
  3. Practice quizzes<br>
  4. Track progress<br><br>

  Type <code>help commands</code> to see available commands.
  `
},

/* ================= FORMAL COMMUNICATION ================= */
{
  k:["what is formal communication","define formal communication"],
  type:"tutorial",
  tags:["communication","formal"],
  v:`
  <b>Formal Communication</b> is professional, structured, and official
  communication used in workplaces, institutions, and academics.<br><br>

  <b>Characteristics:</b>
  <ul>
    <li>Polite and respectful tone</li>
    <li>Grammatically correct sentences</li>
    <li>Clear purpose</li>
    <li>No slang or casual words</li>
  </ul>
  `
},

/* ================= FORMAL EMAIL ================= */
{
  k:["formal email","how to write formal email"],
  type:"tutorial",
  tags:["email","formal"],
  v:`
  <b>Formal Email Format</b><br><br>

  <pre>
Subject: Request for Information

Dear Sir/Madam,

I hope this email finds you well.
I am writing to request information regarding...

Thank you for your time and consideration.

Sincerely,
Your Name
  </pre>
  `
},

/* ================= FRIENDLY COMMUNICATION ================= */
{
  k:["what is friendly communication","define friendly communication"],
  type:"tutorial",
  tags:["communication","friendly"],
  v:`
  <b>Friendly Communication</b> is casual, warm, and informal communication
  used among friends, peers, and close colleagues.<br><br>

  <b>Characteristics:</b>
  <ul>
    <li>Relaxed tone</li>
    <li>Simple language</li>
    <li>Emojis may be used üôÇ</li>
    <li>Personal connection</li>
  </ul>
  `
},

/* ================= FORMAL VS FRIENDLY ================= */
{
  k:["formal vs friendly","formal and informal communication"],
  type:"info",
  tags:["comparison","communication"],
  v:`
  <b>Formal vs Friendly Communication</b><br><br>

  <table border="1" cellpadding="6">
    <tr><th>Formal</th><th>Friendly</th></tr>
    <tr><td>Professional</td><td>Casual</td></tr>
    <tr><td>No slang</td><td>Slang allowed</td></tr>
    <tr><td>Used in offices</td><td>Used with friends</td></tr>
  </table>
  `
},

/* ================= FORMAL GREETING ================= */
{
  k:["formal greeting","professional greeting"],
  type:"info",
  tags:["greeting","formal"],
  v:`
  <b>Examples of Formal Greetings:</b><br><br>

  <ul>
    <li>Good morning, Sir/Madam</li>
    <li>Dear Professor</li>
    <li>Respected Sir</li>
    <li>Hello Team</li>
  </ul>
  `
},

/* ================= FRIENDLY GREETING ================= */
{
  k:["friendly greeting","casual greeting"],
  type:"info",
  tags:["greeting","friendly"],
  v:`
  <b>Examples of Friendly Greetings:</b><br><br>

  <ul>
    <li>Hi!</li>
    <li>Hello üòä</li>
    <li>Hey there!</li>
    <li>What's up?</li>
  </ul>
  `
},

/* ================= FORMAL REQUEST ================= */
{
  k:["formal request","how to make formal request"],
  type:"tutorial",
  tags:["request","formal"],
  v:`
  <b>Formal Request Example:</b><br><br>

  <pre>
I kindly request you to grant me permission
to attend the workshop scheduled on Monday.
  </pre>
  `
},

/* ================= FRIENDLY REQUEST ================= */
{
  k:["friendly request","casual request"],
  type:"tutorial",
  tags:["request","friendly"],
  v:`
  <b>Friendly Request Example:</b><br><br>

  <pre>
Hey! Can you please help me with this?
I‚Äôd really appreciate it üôÇ
  </pre>
  `
},

/* ================= FORMAL APOLOGY ================= */
{
  k:["formal apology","professional apology"],
  type:"tutorial",
  tags:["apology","formal"],
  v:`
  <b>Formal Apology Example:</b><br><br>

  <pre>
I sincerely apologize for the inconvenience caused.
Please accept my apologies for the delay.
  </pre>
  `
},

/* ================= FRIENDLY APOLOGY ================= */
{
  k:["friendly apology","casual apology"],
  type:"tutorial",
  tags:["apology","friendly"],
  v:`
  <b>Friendly Apology Example:</b><br><br>

  <pre>
Sorry about that!
My bad üòÖ
  </pre>
  `
},

/* ================= WHEN TO USE FORMAL ================= */
{
  k:["when to use formal communication"],
  type:"info",
  tags:["usage","formal"],
  v:`
  <b>Use Formal Communication When:</b>
  <ul>
    <li>Writing official emails</li>
    <li>Talking to seniors or teachers</li>
    <li>Giving presentations</li>
    <li>Applying for jobs</li>
  </ul>
  `
},

/* ================= WHEN TO USE FRIENDLY ================= */
{
  k:["when to use friendly communication"],
  type:"info",
  tags:["usage","friendly"],
  v:`
  <b>Use Friendly Communication When:</b>
  <ul>
    <li>Chatting with friends</li>
    <li>Talking to classmates</li>
    <li>Informal team discussions</li>
    <li>Social media conversations</li>
  </ul>
  `
},

/* ================= BASIC GREETINGS ================= */
{
  k:["hi","hello","hey","hii","helo"],
  type:"friendly",
  tags:["greeting"],
  v:`üëã Hello! I'm <b>QuizzoneAI</b>. How can I help you today?`
},
{
  k:["good morning"],
  type:"friendly",
  tags:["greeting"],
  v:`üåÖ Good morning! Hope you have a productive day ahead.`
},
{
  k:["good afternoon"],
  type:"friendly",
  tags:["greeting"],
  v:`‚òÄÔ∏è Good afternoon! How can I assist you right now?`
},
{
  k:["good evening"],
  type:"friendly",
  tags:["greeting"],
  v:`üåá Good evening! What would you like to learn today?`
},
{
  k:["good night"],
  type:"friendly",
  tags:["greeting"],
  v:`üåô Good night! Let me know if you need help before you rest.`
},

/* ================= CASUAL TALK ================= */
{
  k:["how are you","how r you"],
  type:"friendly",
  tags:["casual"],
  v:`I'm doing great üòä Ready to help you learn something new!`
},
{
  k:["what's up","whats up"],
  type:"friendly",
  tags:["casual"],
  v:`Not much‚Äîjust here to help you üöÄ What‚Äôs on your mind?`
},
{
  k:["are you there"],
  type:"friendly",
  tags:["casual"],
  v:`Yes! I'm right here and ready to help you üëç`
},
{
  k:["thank you","thanks"],
  type:"friendly",
  tags:["gratitude"],
  v:`You're welcome üòä Happy to help!`
},
{
  k:["ok","okay"],
  type:"neutral",
  tags:["ack"],
  v:`üëç Alright! Let me know when you need anything.`
},

/* ================= IDENTITY ================= */
{
  k:["who are you","who r you"],
  type:"info",
  tags:["identity"],
  v:`I am <b>QuizzoneAI</b> ‚Äî your smart learning assistant ü§ñüìò`
},
{
  k:["what is your name"],
  type:"info",
  tags:["identity"],
  v:`My name is <b>QuizzoneAI</b>. I'm here to assist your learning journey.`
},
{
  k:["are you ai"],
  type:"info",
  tags:["identity"],
  v:`Yes ü§ñ I am an AI-powered assistant designed for learning and guidance.`
},
{
  k:["are you human"],
  type:"info",
  tags:["identity"],
  v:`No, I'm an AI‚Äîbut I try to communicate in a human-friendly way üòä`
},

/* ================= PURPOSE ================= */
{
  k:["what can you do","help me","how can you help"],
  type:"info",
  tags:["purpose"],
  v:`
  I can help you with:
  <ul>
    <li>Learning concepts</li>
    <li>Code examples</li>
    <li>Quizzes & practice</li>
    <li>Commands & navigation</li>
  </ul>`
},
{
  k:["why are you here"],
  type:"info",
  tags:["purpose"],
  v:`I'm here to help you learn faster and smarter üìö‚ö°`
},

/* ================= FRIENDLY CONFIRMATIONS ================= */
{
  k:["yes"],
  type:"neutral",
  tags:["confirm"],
  v:`üëç Great! Go ahead.`
},
{
  k:["no"],
  type:"neutral",
  tags:["confirm"],
  v:`No problem üòä Let me know if you change your mind.`
},
{
  k:["maybe"],
  type:"neutral",
  tags:["confirm"],
  v:`Alright! Take your time üôÇ`
},

/* ================= CONVERSATION STARTERS ================= */
{
  k:["start","let's start","begin"],
  type:"friendly",
  tags:["start"],
  v:`üöÄ Awesome! What would you like to start with?`
},
{
  k:["help"],
  type:"info",
  tags:["help"],
  v:`Type <code>help commands</code> to see what I can do.`
},

/* ================= POLITE PHRASES ================= */
{
  k:["please"],
  type:"friendly",
  tags:["polite"],
  v:`Of course üôÇ How can I assist you?`
},
{
  k:["sorry"],
  type:"friendly",
  tags:["polite"],
  v:`No worries at all üòä`
},

/* ================= ENDING / EXIT ================= */
{
  k:["bye","goodbye","see you"],
  type:"friendly",
  tags:["exit"],
  v:`üëã Goodbye! Come back anytime‚ÄîI'm always here.`
},
{
  k:["exit","close"],
  type:"neutral",
  tags:["exit"],
  v:`If you need anything later, just open QuizzoneAI again üòä`
},

/* ================= FUN / LIGHT ================= */
{
  k:["lol","haha"],
  type:"friendly",
  tags:["fun"],
  v:`üòÑ Glad you're enjoying the conversation!`
},
{
  k:["nice"],
  type:"friendly",
  tags:["fun"],
  v:`üëç Happy you liked it!`
},

/* ================= USER CHECK ================= */
{
  k:["are you working"],
  type:"info",
  tags:["status"],
  v:`Yes ‚úÖ I'm running perfectly and ready to assist you.`
},
{
  k:["online"],
  type:"info",
  tags:["status"],
  v:`I'm online and active üü¢`
},

/* ================= EMOTIONAL RESPONSES ================= */
{
  k:["i am sad","feeling sad","i feel low"],
  type:"emotional",
  tags:["sad"],
  v:`I'm sorry you're feeling this way üòî. I'm here with you.`
},
{
  k:["i am happy","feeling happy","i am excited"],
  type:"emotional",
  tags:["happy"],
  v:`That's wonderful to hear! üòÑ Keep smiling!`
},
{
  k:["i am angry","i am frustrated","so angry"],
  type:"emotional",
  tags:["angry"],
  v:`I understand your frustration üò§. Let's solve it calmly.`
},
{
  k:["i am confused","confused","i don't understand"],
  type:"emotional",
  tags:["confused"],
  v:`It's okay to be confused üôÇ Let's break it down step by step.`
},
{
  k:["i am stressed","feeling stressed"],
  type:"emotional",
  tags:["stress"],
  v:`Take a deep breath üåø. We‚Äôll handle this together.`
},
{
  k:["i feel lonely"],
  type:"emotional",
  tags:["lonely"],
  v:`You're not alone ü§ç I'm here to talk.`
},
{
  k:["i am tired","feeling tired"],
  type:"emotional",
  tags:["tired"],
  v:`You might need a short break ‚òï. Learning works better with rest.`
},
{
  k:["i am nervous"],
  type:"emotional",
  tags:["nervous"],
  v:`It's normal to feel nervous üôÇ You‚Äôre doing fine.`
},
{
  k:["i feel lost"],
  type:"emotional",
  tags:["lost"],
  v:`Let‚Äôs find direction together üß≠. Tell me what you need.`
},
{
  k:["i am scared"],
  type:"emotional",
  tags:["fear"],
  v:`I understand your fear üòü. You‚Äôre safe here.`
},

/* ================= MOTIVATIONAL RESPONSES ================= */
{
  k:["motivate me","need motivation"],
  type:"motivation",
  tags:["motivation"],
  v:`üåü Believe in yourself. Every step forward matters.`
},
{
  k:["i want to give up"],
  type:"motivation",
  tags:["low"],
  v:`Don't give up üí™. You're closer than you think.`
},
{
  k:["i failed","i failed exam"],
  type:"motivation",
  tags:["failure"],
  v:`Failure is a lesson, not the end üìò. Try again.`
},
{
  k:["i can't do this"],
  type:"motivation",
  tags:["confidence"],
  v:`You CAN do this üöÄ. Let's take it one step at a time.`
},
{
  k:["i feel weak"],
  type:"motivation",
  tags:["strength"],
  v:`Strength grows through effort üí™. Keep going.`
},
{
  k:["i need encouragement"],
  type:"motivation",
  tags:["encourage"],
  v:`You're doing better than you realize üåà.`
},
{
  k:["i am behind others"],
  type:"motivation",
  tags:["comparison"],
  v:`Everyone moves at their own pace üïäÔ∏è. Stay focused.`
},
{
  k:["hard work"],
  type:"motivation",
  tags:["effort"],
  v:`Hard work always pays off üèÜ‚Äîmaybe not today, but soon.`
},
{
  k:["success"],
  type:"motivation",
  tags:["success"],
  v:`Success comes to those who persist üåü.`
},
{
  k:["study motivation"],
  type:"motivation",
  tags:["study"],
  v:`Study smart, stay consistent üìö. You‚Äôve got this.`
},

/* ================= STUDENT RESPONSES ================= */
{
  k:["exam stress","exam fear"],
  type:"student",
  tags:["exam"],
  v:`Exams test knowledge, not your worth ‚ú®. Stay calm.`
},
{
  k:["how to study","study tips"],
  type:"student",
  tags:["study"],
  v:`Create a plan üìÖ, revise regularly, and take breaks.`
},
{
  k:["i failed exam"],
  type:"student",
  tags:["exam"],
  v:`Failure is temporary üìò. Improvement starts now.`
},
{
  k:["homework help"],
  type:"student",
  tags:["homework"],
  v:`Sure üôÇ Tell me the subject or question.`
},
{
  k:["i hate studying"],
  type:"student",
  tags:["study"],
  v:`Try shorter sessions ‚è±Ô∏è and reward yourself after.`
},
{
  k:["i am slow learner"],
  type:"student",
  tags:["learning"],
  v:`Learning speed doesn't define intelligence üå±.`
},
{
  k:["revision"],
  type:"student",
  tags:["revision"],
  v:`Regular revision improves memory üîÅ.`
},
{
  k:["focus problem"],
  type:"student",
  tags:["focus"],
  v:`Try studying without distractions üîï for 25 minutes.`
},
{
  k:["career confusion"],
  type:"student",
  tags:["career"],
  v:`Exploration is part of growth üß≠. Ask me for guidance.`
},
{
  k:["college stress"],
  type:"student",
  tags:["college"],
  v:`Balance is important ‚öñÔ∏è. You‚Äôre doing your best.`
},

/* ================= TEACHER / INTERVIEW ================= */
{
  k:["introduce yourself interview"],
  type:"formal",
  tags:["interview"],
  v:`Good morning. I am a motivated learner with strong interest in growth.`
},
{
  k:["strengths interview"],
  type:"formal",
  tags:["interview"],
  v:`My strengths include consistency, adaptability, and problem-solving.`
},
{
  k:["weakness interview"],
  type:"formal",
  tags:["interview"],
  v:`I focus on turning weaknesses into improvement opportunities.`
},
{
  k:["why should we hire you"],
  type:"formal",
  tags:["interview"],
  v:`I bring dedication, learning mindset, and responsibility.`
},
{
  k:["teacher question"],
  type:"formal",
  tags:["education"],
  v:`Yes sir/ma‚Äôam, I understand the concept clearly.`
},
{
  k:["professional answer"],
  type:"formal",
  tags:["professional"],
  v:`Thank you for the opportunity to explain.`
},
{
  k:["presentation"],
  type:"formal",
  tags:["presentation"],
  v:`Good morning everyone. Today I will discuss‚Ä¶`
},
{
  k:["formal reply"],
  type:"formal",
  tags:["reply"],
  v:`Thank you for your consideration.`
},
{
  k:["office communication"],
  type:"formal",
  tags:["office"],
  v:`I will complete the task within the deadline.`
},
{
  k:["polite response"],
  type:"formal",
  tags:["polite"],
  v:`Certainly. I will look into it promptly.`
},

/* ================= MULTILINGUAL GREETINGS ================= */
{
  k:["namaste","‡§®‡§Æ‡§∏‡•ç‡§§‡•á"],
  type:"greeting",
  tags:["hindi"],
  v:`üôè ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Å‡•§`
},
{
  k:["kaise ho","‡§ï‡•à‡§∏‡•á ‡§π‡•ã"],
  type:"greeting",
  tags:["hinglish"],
  v:`‡§Æ‡•à‡§Ç ‡§†‡•Ä‡§ï ‡§π‡•Ç‡§Å üòä ‡§Ü‡§™ ‡§ï‡•à‡§∏‡•á ‡§π‡•à‡§Ç?`
},
{
  k:["hello ji"],
  type:"greeting",
  tags:["hinglish"],
  v:`Hello ji üëã ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?`
},
{
  k:["good morning hindi"],
  type:"greeting",
  tags:["hindi"],
  v:`üåÖ ‡§∂‡•Å‡§≠ ‡§™‡•ç‡§∞‡§≠‡§æ‡§§! ‡§Ü‡§™‡§ï‡§æ ‡§¶‡§ø‡§® ‡§Æ‡§Ç‡§ó‡§≤‡§Æ‡§Ø ‡§π‡•ã‡•§`
},
{
  k:["shukriya","‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶"],
  type:"greeting",
  tags:["hindi"],
  v:`‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à üôè`
},
{
  k:["bye hindi"],
  type:"greeting",
  tags:["hindi"],
  v:`üëã ‡§´‡§ø‡§∞ ‡§Æ‡§ø‡§≤‡•á‡§Ç‡§ó‡•á! ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡§ñ‡•á‡§Ç‡•§`
},
{
  k:["hello dost"],
  type:"greeting",
  tags:["friendly"],
  v:`‡§π‡•á‡§≤‡•ã ‡§¶‡•ã‡§∏‡•ç‡§§ üòÑ ‡§ï‡•ç‡§Ø‡§æ ‡§∏‡•Ä‡§ñ‡§®‡§æ ‡§π‡•à ‡§Ü‡§ú?`
},
{
  k:["kya haal hai"],
  type:"greeting",
  tags:["hinglish"],
  v:`‡§∏‡§¨ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ üòÑ ‡§Ü‡§™ ‡§¨‡§§‡§æ‡§á‡§è?`
},
{
  k:["hi bro"],
  type:"greeting",
  tags:["friendly"],
  v:`Hi bro üëä Ready to learn?`
},
{
  k:["hello friend"],
  type:"greeting",
  tags:["friendly"],
  v:`Hello friend üòä How can I help today?`
}
];


/* =====================================================
   CHAT OPERATIONS
===================================================== */
function newChat(){
  const id = genId(10);
  chats[id] = createChat(id, true);
  activeChatId = id;
  state.activeChatId = id;
  saveState();
  renderChatList();
  renderMessages();
}

function clearChat(){
  chats[activeChatId].messages = [];
  saveState();
  renderMessages();
}

function deleteMessage(msgId){
  chats[activeChatId].messages =
    chats[activeChatId].messages.filter(m=>m.id!==msgId);
  saveState();
  renderMessages();
}

/* =====================================================
   SEND MESSAGE
===================================================== */
function send(){
  const input = document.getElementById("input");
  const text = input.value.trim();
  if(!text) return;
  input.value="";

  chats[activeChatId].messages.push({
    id: genId(24),
    role:"user",
    content:text,
    time: now()
  });

  saveState();
  renderMessages();
  // COMMAND CHECK
const isCommand = handleCommand(text);
if(isCommand) return;
    // AI RESPONSE
  aiRespond(text);
}

function handleCommand(text){
  const cmd = text.toLowerCase().trim();

  // CLEAR CHAT
  if(cmd === "clear chat"){
    clearChat();
    systemMessage("Chat cleared successfully.");
    return true;
  }

  // NEW CHAT
  if(cmd === "new chat"){
    newChat();
    systemMessage("New chat created.");
    return true;
  }

  // DELETE MESSAGE BY ID
  if(cmd.startsWith("delete message id")){
    const id = cmd.split("=").pop()?.trim();
    if(id){
      deleteMessage(id);
      systemMessage(`Message ${id} deleted.`);
    }
    return true;
  }

  // DELETE CURRENT CHAT
  if(cmd === "delete chat"){
    deleteActiveChat();
    systemMessage("Chat deleted.");
    return true;
  }

    // RENAME CHAT
  if(cmd.startsWith("rename chat")){
    const title = text.split("=").pop()?.trim();
    if(title){
      chats[activeChatId].title = title;
      saveState();
      renderChatList();
      systemMessage(`Chat renamed to "${title}".`);
    }
    return true;
  }

  // LIST CHATS
  if(cmd === "list chats"){
    const names = Object.values(chats)
      .map(c => `‚Ä¢ ${c.title}`)
      .join("<br>");
    systemMessage(`<b>Your Chats</b><br>${names}`);
    return true;
  }

  // PIN CHAT
  if(cmd === "pin chat"){
    chats[activeChatId].pinned = true;
    saveState();
    systemMessage("Chat pinned.");
    return true;
  }

  // UNPIN CHAT
  if(cmd === "unpin chat"){
    chats[activeChatId].pinned = false;
    saveState();
    systemMessage("Chat unpinned.");
    return true;
  }

  // ARCHIVE CHAT
  if(cmd === "archive chat"){
    chats[activeChatId].archived = true;
    saveState();
    systemMessage("Chat archived.");
    return true;
  }

  // RESTORE CHAT
  if(cmd === "restore chat"){
    chats[activeChatId].archived = false;
    saveState();
    systemMessage("Chat restored.");
    return true;
  }

  // SHOW LAST MESSAGE
  if(cmd === "last message"){
    const msgs = chats[activeChatId].messages;
    const last = msgs[msgs.length - 1];
    if(last){
      systemMessage(`<b>Last Message:</b><br>${last.content}`);
    }
    return true;
  }

  // DELETE LAST MESSAGE
  if(cmd === "delete last message"){
    chats[activeChatId].messages.pop();
    saveState();
    renderMessages();
    systemMessage("Last message deleted.");
    return true;
  }

  // COUNT MESSAGES
  if(cmd === "count messages"){
    const count = chats[activeChatId].messages.length;
    systemMessage(`Total messages in this chat: <b>${count}</b>`);
    return true;
  }

  // SEARCH MESSAGE
  if(cmd.startsWith("search message")){
    const key = text.split("=").pop()?.trim();
    if(key){
      const found = chats[activeChatId].messages
        .filter(m => m.content.toLowerCase().includes(key.toLowerCase()))
        .map(m => `‚Ä¢ ${m.content.substring(0,60)}...`)
        .join("<br>");
      systemMessage(found || "No matching messages found.");
    }
    return true;
  }

  // TOGGLE THEME
  if(cmd === "toggle theme"){
    toggleTheme();
    systemMessage("Theme toggled.");
    return true;
  }

  // DARK MODE
  if(cmd === "dark mode"){
    document.body.dataset.theme = "dark";
    systemMessage("Dark mode enabled.");
    return true;
  }

  // LIGHT MODE
  if(cmd === "light mode"){
    document.body.dataset.theme = "light";
    systemMessage("Light mode enabled.");
    return true;
  }

  // CLEAR INPUT
  if(cmd === "clear input"){
    document.getElementById("input").value = "";
    systemMessage("Input cleared.");
    return true;
  }

  // SCROLL TO BOTTOM
  if(cmd === "scroll bottom"){
    document.getElementById("chatArea").scrollTop =
      document.getElementById("chatArea").scrollHeight;
    systemMessage("Scrolled to bottom.");
    return true;
  }

  // HELP
  if(cmd === "help" || cmd === "help commands"){
    systemMessage(`
      <b>Available Commands</b><br>
      clear chat<br>
      new chat<br>
      delete message id = ...<br>
      rename chat = title<br>
      list chats<br>
      pin chat / unpin chat<br>
      archive chat / restore chat<br>
      last message<br>
      delete last message<br>
      count messages<br>
      search message = keyword<br>
      toggle theme / dark mode / light mode<br>
      clear input<br>
      scroll bottom
    `);
    return true;
  }

    /* ================= HTML MANIPULATION ================= */

  // ADD BANNER TO CHAT AREA
  if(cmd === "add banner"){
    document.getElementById("chatArea")
      .insertAdjacentHTML("afterbegin",
      `<div class="qa-banner">‚ö° QuizzoneAI Live Workspace</div>`);
    systemMessage("Banner added to chat area.");
    return true;
  }

  // CLEAR CHAT AREA HTML (NOT DATA)
  if(cmd === "clear chat html"){
    document.getElementById("chatArea").innerHTML = "";
    systemMessage("Chat area HTML cleared (data preserved).");
    return true;
  }

  // ADD FOOTER NOTE
  if(cmd.startsWith("add footer note")){
    const note = text.split("=").pop()?.trim();
    if(note){
      document.body.insertAdjacentHTML(
        "beforeend",
        `<div class="qa-footer-note">${note}</div>`
      );
      systemMessage("Footer note added.");
    }
    return true;
  }

  // REPLACE HEADER TITLE
  if(cmd.startsWith("replace header title")){
    const title = text.split("=").pop()?.trim();
    if(title){
      document.querySelector(".topbar strong").innerHTML = title;
      systemMessage("Header title updated.");
    }
    return true;
  }

  // ADD INFO CARD
  if(cmd === "add info card"){
    document.getElementById("chatArea")
      .insertAdjacentHTML("beforeend",
      `<div class="qa-info-card">
        <h4>Info</h4>
        <p>This UI element was injected via command.</p>
      </div>`);
    systemMessage("Info card injected.");
    return true;
  }

  /* ================= CSS INJECTION ================= */

  // INJECT CSS INLINE
  if(cmd.startsWith("inject css")){
    const css = text.split("=").pop();
    if(css){
      const style = document.createElement("style");
      style.innerHTML = css;
      document.head.appendChild(style);
      systemMessage("CSS injected successfully.");
    }
    return true;
  }

  // ADD DEFAULT UI CSS PACK
  if(cmd === "apply soft ui"){
    const style = document.createElement("style");
    style.innerHTML = `
      .qa-banner{
        padding:10px;
        background:linear-gradient(90deg,#2563eb,#38bdf8);
        color:white;
        border-radius:10px;
        margin-bottom:12px;
        text-align:center;
      }
      .qa-info-card{
        background:#f1f5ff;
        border-left:4px solid #2563eb;
        padding:12px;
        border-radius:10px;
        margin-top:12px;
      }
      .qa-footer-note{
        position:fixed;
        bottom:10px;
        right:10px;
        background:#020617;
        color:white;
        padding:8px 12px;
        border-radius:10px;
        font-size:12px;
      }
    `;
    document.head.appendChild(style);
    systemMessage("Soft UI style pack applied.");
    return true;
  }

  // RESET ALL INJECTED STYLES
  if(cmd === "reset styles"){
    document.querySelectorAll("style").forEach(s=>{
      if(s.innerHTML.includes("qa-")) s.remove();
    });
    systemMessage("Injected styles removed.");
    return true;
  }

  /* ================= DOM TRANSFORM ================= */

  // HIGHLIGHT USER MESSAGES
  if(cmd === "highlight user messages"){
    document.querySelectorAll(".message.user .bubble")
      .forEach(el=>{
        el.style.boxShadow="0 0 0 2px #38bdf8";
      });
    systemMessage("User messages highlighted.");
    return true;
  }

  // HIGHLIGHT AI MESSAGES
  if(cmd === "highlight ai messages"){
    document.querySelectorAll(".message.ai .bubble")
      .forEach(el=>{
        el.style.boxShadow="0 0 0 2px #22c55e";
      });
    systemMessage("AI messages highlighted.");
    return true;
  }

  // RESET MESSAGE STYLES
  if(cmd === "reset message styles"){
    document.querySelectorAll(".bubble")
      .forEach(el=>el.style.boxShadow="none");
    systemMessage("Message styles reset.");
    return true;
  }

  // COLLAPSE SIDEBAR
  if(cmd === "collapse sidebar"){
    document.querySelector(".sidebar").style.width="60px";
    systemMessage("Sidebar collapsed.");
    return true;
  }

  // EXPAND SIDEBAR
  if(cmd === "expand sidebar"){
    document.querySelector(".sidebar").style.width="300px";
    systemMessage("Sidebar expanded.");
    return true;
  }

  // HIDE INPUT BOX
  if(cmd === "hide input"){
    document.querySelector(".input-box").style.display="none";
    systemMessage("Input box hidden.");
    return true;
  }

  // SHOW INPUT BOX
  if(cmd === "show input"){
    document.querySelector(".input-box").style.display="flex";
    systemMessage("Input box shown.");
    return true;
  }

    /* ================= SESSION & NAVIGATION ================= */

  // LOGOUT USER
  if(cmd === "logout"){
    localStorage.removeItem("ActiveQuizzoneUser");
    systemMessage("You have been logged out. Redirecting...");
    setTimeout(()=>{
      window.location.href = "/Quizzone/Home/SignIn.htm";
    }, 1200);
    return true;
  }

  // SWITCH TO NEXT CHAT
  if(cmd === "next chat"){
    const ids = Object.keys(chats);
    let idx = ids.indexOf(activeChatId);
    if(idx < ids.length - 1){
      activeChatId = ids[idx + 1];
      state.activeChatId = activeChatId;
      saveState();
      renderChatList();
      renderMessages();
      systemMessage("Moved to next chat.");
    }
    return true;
  }

  // SWITCH TO PREVIOUS CHAT
  if(cmd === "previous chat"){
    const ids = Object.keys(chats);
    let idx = ids.indexOf(activeChatId);
    if(idx > 0){
      activeChatId = ids[idx - 1];
      state.activeChatId = activeChatId;
      saveState();
      renderChatList();
      renderMessages();
      systemMessage("Moved to previous chat.");
    }
    return true;
  }

  // SWITCH TO CHAT BY ID
  if(cmd.startsWith("go to chat id")){
    const id = text.split("=").pop()?.trim();
    if(chats[id]){
      activeChatId = id;
      state.activeChatId = id;
      saveState();
      renderChatList();
      renderMessages();
      systemMessage(`Switched to chat ${id}.`);
    } else {
      systemMessage("Chat ID not found.");
    }
    return true;
  }

  // GO TO FIRST CHAT
  if(cmd === "first chat"){
    const first = Object.keys(chats)[0];
    activeChatId = first;
    state.activeChatId = first;
    saveState();
    renderChatList();
    renderMessages();
    systemMessage("Moved to first chat.");
    return true;
  }

  // GO TO LAST CHAT
  if(cmd === "last chat"){
    const ids = Object.keys(chats);
    activeChatId = ids[ids.length - 1];
    state.activeChatId = activeChatId;
    saveState();
    renderChatList();
    renderMessages();
    systemMessage("Moved to last chat.");
    return true;
  }

  // RELOAD QUIZZONEAI (SOFT)
  if(cmd === "reload ai"){
    systemMessage("Reloading QuizzoneAI workspace...");
    setTimeout(()=>location.reload(), 800);
    return true;
  }

  // RESET AI SESSION (KEEP LOGIN)
  if(cmd === "reset ai"){
    localStorage.removeItem("QUIZZONE_AI_STATE");
    systemMessage("AI session reset. Reloading...");
    setTimeout(()=>location.reload(), 800);
    return true;
  }

  // LOCK WORKSPACE
  if(cmd === "lock workspace"){
    document.body.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:center;
                  height:100vh;font-family:Segoe UI">
        <div style="padding:30px;border-radius:16px;
                    background:#020617;color:white;text-align:center">
          <h2>Workspace Locked</h2>
          <p>Refresh or login again to continue.</p>
        </div>
      </div>`;
    return true;
  }

  // EXIT QUIZZONEAI SAFELY
  if(cmd === "exit ai"){
    systemMessage("Exiting QuizzoneAI...");
    setTimeout(()=>{
      window.location.href = "/Quizzone/index.htm";
    }, 1200);
    return true;
  }

    /* ================= QUIZZONE INTERNAL LINKS ================= */

  // OPEN QUIZZONE HOME
  if(cmd === "open quizzone home" || cmd === "go to quizzone home" || cmd === "quizzone home" || cmd === "open home" || cmd === "go to home" || cmd === "home" || cmd === "Open Home" || cmd === "Open Quizzone Home"){
    systemMessage("Opening Quizzone Home‚Ä¶");
    window.location.href = "/Quizzone/index.htm";
    return true;
  }

  // OPEN DISCIPLINES
  if(cmd === "open disciplines" || cmd === "go to disciplines" || cmd === "disciplines" || cmd === "open subjects" || cmd === "go to subjects" || cmd === "subjects" || cmd === "open courses" || cmd === "go to courses" || cmd === "courses" || cmd === "open learning material" || cmd === "go to learning material" || cmd === "learning material" || cmd === "open syllabus" || cmd === "go to syllabus" || cmd === "syllabus" || cmd === "Open Courses" || cmd === "Open Subjects" || cmd === "Open Disciplines"){
    systemMessage("Opening Disciplines‚Ä¶");
    window.location.href = "/Quizzone/Disciplines/index.htm";
    return true;
  }

  // OPEN COMPETENCY TESTS
  if(cmd === "open competency tests" || cmd === "competency test" || cmd === "Go to Competency Tests"){
    systemMessage("Opening Competency Tests‚Ä¶");
    window.location.href = "/Quizzone/CompetancyTest/index.htm";
    return true;
  }

  // OPEN PROGRESS DASHBOARD
  if(cmd === "open progress" || cmd === "open progress dashboard" || cmd === "go to progress dashboard" || cmd === "go to progress" || cmd === "progress dashboard"){
    systemMessage("Opening Progress Dashboard‚Ä¶");
    window.location.href = "/Quizzone/Home/Progress.htm";
    return true;
  }

  // OPEN SETTINGS
  if(cmd === "open settings" || cmd === "go to settings" || cmd === "settings" || cmd === "open account settings" || cmd === "account settings"){
    systemMessage("Opening Account Settings‚Ä¶");
    window.location.href = "/Quizzone/Home/Setting.htm";
    return true;
  }

  // OPEN ABOUT QUIZZONE
  if(cmd === "open about quizzone" || cmd === "about quizzone" || cmd === "go to about quizzone" || cmd === "about"){
    systemMessage("Opening About Quizzone‚Ä¶");
    window.location.href = "/Quizzone/Documentary/OwnerMessageViewer.htm";
    return true;
  }

  /* ================= OWNER / CREATOR LINKS ================= */

  // OPEN CREATOR PORTFOLIO
  if(cmd === "open owner portfolio" || cmd === "open creator portfolio" || cmd === "creator portfolio" || cmd === "owner portfolio"){
    systemMessage("Opening creator portfolio‚Ä¶");
    window.open("https://akshat-881236.github.io/Portfolio-881236/", "_blank");
    return true;
  }

  // OPEN GITHUB
  if(cmd === "open github" || cmd === "open github profile" || cmd === "github profile" || cmd === "github" || cmd === "open owner github" || cmd === "open creator github" || cmd === "Akshat Prasad GitHub" || cmd === "open Akshat Prasad GitHub" || cmd === "open Akshat-881236 GitHub"){
    systemMessage("Opening GitHub profile‚Ä¶");
    window.open("https://github.com/Akshat-881236", "_blank");
    return true;
  }

  // OPEN LINKEDIN
  if(cmd === "open linkedin" || cmd === "open linkedin profile" || cmd === "linkedin profile" || cmd === "linkedin" || cmd === "open owner linkedin" || cmd === "open creator linkedin"){
    systemMessage("Opening LinkedIn profile‚Ä¶");
    window.open("https://linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&followMember=akshat-prasad-b53936379", "_blank");
    return true;
  }

  // OPEN EMAIL CLIENT
  if(cmd === "contact owner" || cmd === "email owner" || cmd === "contact creator" || cmd === "email creator" || cmd === "open email client"){
    systemMessage("Opening email client‚Ä¶");
    window.location.href = "mailto:akshatpsd2005@gmail.com";
    return true;
  }

  /* ================= OTHER PROJECTS ================= */

  // OPEN QUIZZONE PROJECT REPO
  if(cmd === "open quizzone project" || cmd === "open quizzone repository" || cmd === "quizzone project" || cmd === "quizzone repository"){
    systemMessage("Opening Quizzone Project Repository‚Ä¶");
    window.open("https://github.com/Akshat-881236/Quizzone", "_blank");
    return true;
  }

  // OPEN LEARNING CLUB
  if(cmd === "open learning club" || cmd === "learning club" || cmd === "open learning club project"){
    systemMessage("Opening Learning Club‚Ä¶");
    window.open("https://akshat-881236.github.io/LearningClub-Key-of-Success-Learning-Point/", "_blank");
    return true;
  }

  // OPEN ALL PROJECTS PAGE
  if(cmd === "open all projects" || cmd === "all projects" || cmd === "open projects page" || cmd === "projects page" || cmd === "open owner projects" || cmd === "open creator projects" || cmd === "Tell me about your other projects" || cmd === "show me your other projects" || cmd === "show all projects"){
    systemMessage("Opening all projects‚Ä¶");
    window.open("https://github.com/Akshat-881236", "_blank");
    return true;
  }

  // COMMAND TRIGGER GOOGLE SEARCH
  if(cmd.startsWith("search google for") || cmd.startsWith("google search for") || cmd.startsWith("search on google for") || cmd.startsWith("search in google for") || cmd.startsWith("Search Google for") || cmd.startsWith("Google search for") || cmd.startsWith("Search on Google for") || cmd.startsWith("Search in Google for") || cmd.startsWith("search google about") || cmd.startsWith("google search about") || cmd.startsWith("search on google about") || cmd.startsWith("search in google about") || cmd.startsWith("Search Google about") || cmd.startsWith("Google search about") || cmd.startsWith("Search on Google about") || cmd.startsWith("Search in Google about")){
    const query = text.split("for").pop()?.trim() ||
                  text.split("about").pop()?.trim();
    if(query){
      systemMessage(`Searching Google for "${query}"...`);
      window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, "_blank");
    }
  }

  // COMMAND TRIGGER YOUTUBE SEARCH
  if(cmd.startsWith("search youtube for") || cmd.startsWith("youtube search for") || cmd.startsWith("search on youtube for") || cmd.startsWith("search in youtube for") || cmd.startsWith("Search YouTube for") || cmd.startsWith("YouTube search for") || cmd.startsWith("Search on YouTube for") || cmd.startsWith("Search in YouTube for") || cmd.startsWith("search youtube about") || cmd.startsWith("youtube search about") || cmd.startsWith("search on youtube about") || cmd.startsWith("search in youtube about") || cmd.startsWith("Search YouTube about") || cmd.startsWith("YouTube search about") || cmd.startsWith("Search on YouTube about") || cmd.startsWith("Search in YouTube about")){
    const query = text.split("for").pop()?.trim() ||
                  text.split("about").pop()?.trim();
    if(query){
      systemMessage(`Searching YouTube for "${query}"...`);
      window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`, "_blank");
    }
  }

  // COMMAND TRIGGER WIKIPEDIA SEARCH
  if(cmd.startsWith("search wikipedia for") || cmd.startsWith("wikipedia search for") || cmd.startsWith("search on wikipedia for") || cmd.startsWith("search in wikipedia for") || cmd.startsWith("Search Wikipedia for") || cmd.startsWith("Wikipedia search for") || cmd.startsWith("Search on Wikipedia for") || cmd.startsWith("Search in Wikipedia for") || cmd.startsWith("search wikipedia about") || cmd.startsWith("wikipedia search about") || cmd.startsWith("search on wikipedia about") || cmd.startsWith("search in wikipedia about") || cmd.startsWith("Search Wikipedia about") || cmd.startsWith("Wikipedia search about") || cmd.startsWith("Search on Wikipedia about") || cmd.startsWith("Search in Wikipedia about")){
    const query = text.split("for").pop()?.trim() ||
                  text.split("about").pop()?.trim();
    if(query){
      systemMessage(`Searching Wikipedia for "${query}"...`);
      window.open(`https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}`, "_blank");
    }
  }

  // COMMAND TRIGGER DUCKDUCKGO SEARCH
  if(cmd.startsWith("search duckduckgo for") || cmd.startsWith("duckduckgo search for") || cmd.startsWith("search on duckduckgo for") || cmd.startsWith("search in duckduckgo for") || cmd.startsWith("Search DuckDuckGo for") || cmd.startsWith("DuckDuckGo search for") || cmd.startsWith("Search on DuckDuckGo for") || cmd.startsWith("Search in DuckDuckGo for") || cmd.startsWith("search duckduckgo about") || cmd.startsWith("duckduckgo search about") || cmd.startsWith("search on duckduckgo about") || cmd.startsWith("search in duckduckgo about") || cmd.startsWith("Search DuckDuckGo about") || cmd.startsWith("DuckDuckGo search about") || cmd.startsWith("Search on DuckDuckGo about") || cmd.startsWith("Search in DuckDuckGo about")){
    const query = text.split("for").pop()?.trim() ||
                  text.split("about").pop()?.trim();
    if(query){
      systemMessage(`Searching DuckDuckGo for "${query}"...`);
      window.open(`https://duckduckgo.com/?q=${encodeURIComponent(query)}`, "_blank");
    }
  }

  // COMMAND TRIGGER BING SEARCH
  if(cmd.startsWith("search bing for") || cmd.startsWith("bing search for") || cmd.startsWith("search on bing for") || cmd.startsWith("search in bing for") || cmd.startsWith("Search Bing for") || cmd.startsWith("Bing search for") || cmd.startsWith("Search on Bing for") || cmd.startsWith("Search in Bing for") || cmd.startsWith("search bing about") || cmd.startsWith("bing search about") || cmd.startsWith("search on bing about") || cmd.startsWith("search in bing about") || cmd.startsWith("Search Bing about") || cmd.startsWith("Bing search about") || cmd.startsWith("Search on Bing about") || cmd.startsWith("Search in Bing about")){
    const query = text.split("for").pop()?.trim() ||
                  text.split("about").pop()?.trim();
    if(query){
      systemMessage(`Searching Bing for "${query}"...`);
      window.open(`https://www.bing.com/search?q=${encodeURIComponent(query)}`, "_blank");
    }
  }

  // LINKEDIN SEARCH
  if(cmd.startsWith("search linkedin for") || cmd.startsWith("linkedin search for") || cmd.startsWith("search on linkedin for") || cmd.startsWith("search in linkedin for") || cmd.startsWith("Search LinkedIn for") || cmd.startsWith("LinkedIn search for") || cmd.startsWith("Search on LinkedIn for") || cmd.startsWith("Search in LinkedIn for") || cmd.startsWith("search linkedin about") || cmd.startsWith("linkedin search about") || cmd.startsWith("search on linkedin about") || cmd.startsWith("search in linkedin about") || cmd.startsWith("Search LinkedIn about") || cmd.startsWith("LinkedIn search about") || cmd.startsWith("Search on LinkedIn about") || cmd.startsWith("Search in LinkedIn about")){
    const query = text.split("for").pop()?.trim() ||
                  text.split("about").pop()?.trim();
    if(query){
      systemMessage(`Searching LinkedIn for "${query}"...`);
      window.open(`https://www.linkedin.com/search/results/all/?keywords=${encodeURIComponent(query)}`, "_blank");
    }
  }

  // SEARCH OWNER PORTFOLIO ON GOOGLE
  if(cmd === "search owner portfolio on google" || cmd === "search creator portfolio on google" || cmd === "search portfolio on google" || cmd === "google search owner portfolio" || cmd === "google search creator portfolio" || cmd === "google search portfolio" || cmd === "Search Owner Portfolio on Google" || cmd === "Search Creator Portfolio on Google" || cmd === "Search Portfolio on Google" || cmd === "Google Search Owner Portfolio" || cmd === "Google Search Creator Portfolio" || cmd === "Google Search Portfolio" || cmd === "Find Owner Portfolio on Google" || cmd === "Find Creator Portfolio on Google" || cmd === "Find Portfolio on Google" || cmd === "QuizzoneAI, search owner portfolio on Google" || cmd === "QuizzoneAI, search creator portfolio on Google" || cmd === "QuizzoneAI, search portfolio on Google" || cmd === "Hey QuizzoneAI, search owner portfolio on Google" || cmd === "Hey QuizzoneAI, search creator portfolio on Google" || cmd === "Hey QuizzoneAI, search portfolio on Google" || cmd === "Can you search owner portfolio on Google" || cmd === "Can you search creator portfolio on Google" || cmd === "Can you search portfolio on Google"){
    const query = "Akshat Prasad Portfolio";
    systemMessage(`<h1>I'm QuizzoneAI created by Akshat Prasad.</h1> Searching Google for "${query}"...`);
    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, "_blank");
    return true;
  }

    // COMMAND TO CREATE A CUSTOM RESPONSE
  if(cmd.startsWith("teach ai that") || cmd.startsWith("quizzoneai, learn that") || cmd.startsWith("hey quizzoneai, learn that") || cmd.startsWith("you should know that")){
    const parts = text.split("that").pop()?.trim().split("is");
    if(parts && parts.length === 2){
      const key = parts[0].trim().toLowerCase();
      const value = parts[1].trim();
      if(key && value){
        KB.push({
          k: [key],
          type: "custom",
          tags: ["user-taught"],
          v: value
        });
        systemMessage(`Got it! I've learned that "${key}" is "${value}".`);
      } else {
        systemMessage("Please provide both a key and a value.");
      }
    } else {
      systemMessage("Please use the format: teach AI that [key] is [value].");
    }
    return true;
  }

  // EXECUTION BOX REQUEST IN WHICH WE CAN RUN ALL ABOVE COMMANDS WRT BOILERPLATE COMMANDS
  if(cmd === "execute all commands" || cmd === "run all commands" || cmd === "execute all" || cmd === "run all" || cmd === "open execution box" || cmd === "show execution box" || cmd === "activate execution box" || cmd === "launch execution box" || cmd === "Execute All Commands" || cmd === "Run All Commands" || cmd === "Open Execution Box" || cmd === "Show Execution Box" || cmd === "Activate Execution Box" || cmd === "Launch Execution Box" || cmd === "Can you open execution box" || cmd === "Can you show execution box" || cmd === "Can you activate execution box" || cmd === "Can you launch execution box" || cmd === "Hey QuizzoneAI, open execution box" || cmd === "Hey QuizzoneAI, show execution box" || cmd === "Hey QuizzoneAI, activate execution box" || cmd === "Hey QuizzoneAI, launch execution box"){
    systemMessage(`
      <b>Execution Box Activated</b><br>
      You can now run all available commands including boilerplate commands.
      Just type your command in the code container below and click on "Run Button".
      <pre contenteditable="true" id="execBox" style="min-height:80px;
            border:1px solid #ccc;padding:8px;
            border-radius:8px;outline:none;
            font-family:Segoe UI,monospace;
            box-shadow:0 0 5px rgba(0,0,0,0.1);
            margin-top:8px;"> 
// Example Command:
clear chat
new chat
rename chat = My New Chat
delete chat
list chats
pin chat
unpin chat
archive chat
restore chat
last message
delete last message
count messages
search message = keyword
toggle theme
dark mode
light mode
clear input
scroll bottom
help commands
add banner
clear chat html
add footer note = This is a footer note.
replace header title = New Title
add info card
inject css = .message.user { background: #e0f7fa; }
apply soft ui
reset styles
highlight user messages
highlight ai messages
reset message styles
collapse sidebar
expand sidebar
hide input
show input
logout
next chat
// Execute more commands seperated by comas ","
// Click on Edit Button to Edit Commands & then Click on Run Button to Execute.
      </pre>
      <button onclick="
        const cmds = document.getElementById('execBox').innerText.split('\\n');
        cmds.forEach(c => {
          document.getElementById('input').value = c;
          send();
        });
      " style="margin-top:8px;padding:8px 12px;
               background:#2563eb;color:white;
               border:none;border-radius:6px;
               cursor:pointer;">
        Run Commands
      </button>
    `);
    return true;
  }

  // COMMAND TO RETRIEVE CURRENT CHAT ID
  if(cmd === "what is my current chat id" || cmd === "current chat id" || cmd === "show current chat id" || cmd === "display current chat id" || cmd === "give me current chat id" || cmd === "tell me my current chat id" || cmd === "Can you tell me my current chat id" || cmd === "Hey QuizzoneAI, what is my current chat id" || cmd === "Hey QuizzoneAI, current chat id" || cmd === "Hey QuizzoneAI, show current chat id" || cmd === "Hey QuizzoneAI, display current chat id" || cmd === "Hey QuizzoneAI, give me current chat id"){
    systemMessage(`Your current chat ID is: <b>${activeChatId}</b>`);
    return true;
  }

  // COMMAND TO IMPORT ALL CHATS DATA IN WELL STYLE DISPLAY SHOWING CHAT IDS & TITLES AND ALL MESSAGES WITH ROLES & CONTENTS ALONG WITH TIMESTAMPS & IDS
  if(cmd === "export all chats data" || cmd === "get all chats data" || cmd === "show all chats data" || cmd === "display all chats data" || cmd === "give me all chats data" || cmd === "Can you give me all chats data" || cmd === "Hey QuizzoneAI, export all chats data" || cmd === "Hey QuizzoneAI, get all chats data" || cmd === "Hey QuizzoneAI, show all chats data" || cmd === "Hey QuizzoneAI, display all chats data" || cmd === "Hey QuizzoneAI, give me all chats data" || cmd === "Please export all chats data" || cmd === "Please get all chats data" || cmd === "Please show all chats data" || cmd === "Please display all chats data" || cmd === "Please give me all chats data" || cmd === "Kindly export all chats data" || cmd === "Kindly get all chats data" || cmd === "Kindly show all chats data" || cmd === "Kindly display all chats data" || cmd === "Kindly give me all chats data" || cmd === "Could you export all chats data" || cmd === "Could you get all chats data" || cmd === "Could you show all chats data" || cmd === "Could you display all chats data" || cmd === "Could you give me all chats data" || cmd === "I would like to export all chats data" || cmd === "I would like to get all chats data" || cmd === "I would like to show all chats data" || cmd === "I would like to display all chats data" || cmd === "I would like to have all chats data" || cmd === "I want to export all chats data" || cmd === "I want to get all chats data" || cmd === "I want to show all chats data" || cmd === "I want to display all chats data" || cmd === "I want to have all chats data" || cmd === "Export Chats" || cmd === "Get Chats" || cmd === "Show Chats" || cmd === "Display Chats" || cmd === "Give me Chats" || cmd === "Please Export Chats" || cmd === "Please Get Chats" || cmd === "Please Show Chats" || cmd === "Please Display Chats" || cmd === "Please Give me Chats" || cmd === "Kindly Export Chats" || cmd === "Kindly Get Chats" || cmd === "Kindly Show Chats" || cmd === "Kindly Display Chats" || cmd === "Kindly Give me Chats" || cmd === "Could you Export Chats" || cmd === "Could you Get Chats" || cmd === "Could you Show Chats" || cmd === "Could you Display Chats" || cmd === "Could you Give me Chats" || cmd === "I would like to Export Chats" || cmd === "I would like to Get Chats" || cmd === "I would like to Show Chats" || cmd === "I would like to Display Chats" || cmd === "I would like to Have Chats" || cmd === "I want to Export Chats" || cmd === "I want to Get Chats" || cmd === "I want to Show Chats" || cmd === "I want to Display Chats" || cmd === "I want to Have Chats" || cmd === "QuizzoneAI, export all chats data" || cmd === "QuizzoneAI, get all chats data" || cmd === "QuizzoneAI, show all chats data" || cmd === "QuizzoneAI, display all chats data" || cmd === "QuizzoneAI, give me all chats data" || cmd === "QuizzoneAI, Export Chats" || cmd === "QuizzoneAI, Get Chats" || cmd === "QuizzoneAI, Show Chats" || cmd === "QuizzoneAI, Display Chats" || cmd === "QuizzoneAI, Give me Chats" || cmd === "Exports Chats" || cmd === "Gets Chats" || cmd === "Shows Chats" || cmd === "Displays Chats" || cmd === "Gives me Chats" || cmd === "export chat data" || cmd === "get chat data" || cmd === "show chat data" || cmd === "display chat data" || cmd === "give me chat data" || cmd === "QuizzoneAI, export chat data" || cmd === "QuizzoneAI, get chat data" || cmd === "QuizzoneAI, show chat data" || cmd === "QuizzoneAI, display chat data" || cmd === "QuizzoneAI, give me chat data" || cmd === "exports chats" || cmd === "gets chats" || cmd === "shows chats" || cmd === "displays chats" || cmd === "gives me chats"){
    let exportContent = `<b>All Chats Data Export</b><br>`;
    Object.values(chats).forEach(c => {
      exportContent += `<h3>Chat ID: ${c.id} | Title: ${c.title}</h3>`;
      c.messages.forEach(m => {
        exportContent += `
          <div style="margin-left:20px;
                      border-left:2px solid #ccc;
                      padding-left:10px;
                      margin-bottom:8px;">
            <b>Role:</b> ${m.role}<br>
            <b>Content:</b> ${m.content}<br>
            <b>Time:</b> ${m.time}<br>
            <b>Message ID:</b> ${m.id}
          </div>
        `;
      });
    });
    systemMessage(exportContent);
    return true;
  }

  // COMMANDS TO ENCRYPT OR DECRYPT MESSAGES OR CHATS - SIMULATED VIA REVERSING STRINGS FOR DEMO PURPOSES
  if(cmd.startsWith("encrypt message") || cmd.startsWith("decrypt message") || cmd.startsWith("encrypt chat") || cmd.startsWith("decrypt chat")){
    const action = cmd.split(" ")[0]; // encrypt or decrypt
    const target = cmd.split(" ")[1]; // message or chat
    if(target === "message"){
      const lastMsg = chats[activeChatId].messages[chats[activeChatId].messages.length - 1];
      if(lastMsg){
        if(action === "encrypt"){
          lastMsg.content = lastMsg.content.split("").reverse().join("");
          systemMessage("Last message encrypted.");
        } else {
          lastMsg.content = lastMsg.content.split("").reverse().join("");
          systemMessage("Last message decrypted.");
        }
        renderMessages();
        saveState();
      } else {
        systemMessage("No messages to process.");
      }
    } else if(target === "chat"){
      chats[activeChatId].messages.forEach(m => {
        if(action === "encrypt"){
          m.content = m.content.split("").reverse().join("");
        } else {
          m.content = m.content.split("").reverse().join("");
        }
      });
      systemMessage(`All messages in current chat ${action}ed.`);
      renderMessages();
      saveState();
    }
    return true;
  }

  // COMMANDS THAT MAKE ALL TEXT UPPERCASE OR LOWERCASE IN ALL MESSAGES OF CURRENT CHAT AND MAKE IT REFLECTED IMMEDIATELY BUT NOT SAVE PERMANENTLY
  if(cmd === "uppercase all messages" || cmd === "make all messages uppercase" ||
     cmd === "lowercase all messages" || cmd === "make all messages lowercase"){
    const toUpper = cmd.includes("uppercase");
    chats[activeChatId].messages.forEach(m => {
      m.content = toUpper ? m.content.toUpperCase() : m.content.toLowerCase();
    });
    systemMessage(`All messages converted to ${toUpper ? "UPPERCASE" : "lowercase"}.`);
    renderMessages();
    return true;
  }

  if(cmd === "reset ai knowledge" || cmd === "clear ai knowledge" || cmd === "forget user taught data" || cmd === "reset learned data" || cmd === "clear learned data" || cmd === "forget custom responses" || cmd === "reset custom responses"){
    KB = KB.filter(d => d.type !== "custom");
    systemMessage("AI knowledge reset. All user-taught data forgotten.");
    return true;
  }

  // COMMAND TO RETRIEVE TEACH DATA FROM KNOWLEDGE BASE
  if(cmd.startsWith("what do you know about") || cmd.startsWith("tell me about") || cmd.startsWith("give me information about") || cmd.startsWith("what have you learned about")){
    const topic = text.split("about").pop()?.trim().toLowerCase();
    if(topic){
      const entry = KB.find(d => d.k.includes(topic));
      if(entry){
        systemMessage(`I know that "${topic}" is: ${entry.v}`);
      } else {
        systemMessage(`I don't have any information about "${topic}".`);
      }
    } else {
      systemMessage("Please specify a topic to inquire about.");
    }
    return true;
  }

  return false; // not a command
}

function systemMessage(text){
  chats[activeChatId].messages.push({
    id: genId(24),
    role: "ai",
    content: `<i class="bi bi-gear"></i> ${text}`,
    time: now()
  });
  saveState();
  renderMessages();
}



/* =====================================================
   AI RESPONSE (STREAMING)
===================================================== */
function aiRespond(query){
  showCloud(true);

  let response="I am learning.";
  for(let d of KB){
    if(d.k.some(x=>query.toLowerCase().includes(x))){
      response=d.v;
      break;
    }
  }

  const msg = {
    id: genId(24),
    role:"ai",
    content:"",
    time: now()
  };
  chats[activeChatId].messages.push(msg);

  let i=0;
  const timer=setInterval(()=>{
    msg.content += response[i++] || "";
    renderMessages();
    if(i>=response.length){
      clearInterval(timer);
      showCloud(false);
      saveState();
    }
  },18);
}

/* =====================================================
   RENDER CHAT LIST
===================================================== */
function renderChatList(){
  const list=document.getElementById("chatList");
  list.innerHTML="";
  Object.values(chats).forEach(c=>{
    const d=document.createElement("div");
    d.className="chat-item"+(c.id===activeChatId?" active":"");
    d.innerHTML=`<span>${c.title}</span>`;
    d.onclick=()=>{
      activeChatId=c.id;
      state.activeChatId=c.id;
      saveState();
      renderChatList();
      renderMessages();
    };
    list.appendChild(d);
  });
}

/* =====================================================
   RENDER MESSAGES
===================================================== */
function renderMessages(){
  const area=document.getElementById("chatArea");
  area.innerHTML="";
  chats[activeChatId].messages.forEach(m=>{
    const a=document.createElement("article");
    a.className="message "+m.role;
    a.innerHTML=`
      <div class="meta">${m.role==="user"?user.username:"QuizzoneAI"}</div>
      <div class="bubble">${processContent(m.content)}</div>
      <div class="tools">
        <i class="bi bi-trash" onclick="deleteMessage('${m.id}')"></i>
      </div>
    `;
    area.appendChild(a);
  });
  area.scrollTop=area.scrollHeight;
}

/* =====================================================
   CONTENT PROCESSOR (CODE)
===================================================== */
function processContent(raw){
  if(raw.includes("<pre>")){
    const c=raw.replace(/<\/?pre>/g,"");
    return `<div class="code-container"><div class="code-body">${c}</div></div>`;
  }
  return raw;
}

function deleteActiveChat(){
  delete chats[activeChatId];
  const remaining = Object.keys(chats);
  activeChatId = remaining[0];
  state.activeChatId = activeChatId;
  saveState();
  renderChatList();
  renderMessages();
}


/* =====================================================
   CLOUD STATE
===================================================== */
function showCloud(v){
  document.getElementById("cloud").style.display=v?"block":"none";
}

/* =====================================================
   INIT
===================================================== */
renderChatList();
renderMessages();

document.getElementById("input")
  .addEventListener("keydown",e=>{
    if(e.key==="Enter") send();
  });
</script>
</body>
</html>